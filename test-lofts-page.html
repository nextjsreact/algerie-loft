<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Page Lofts - Diagnostic</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .test-section {
            background: white;
            margin: 20px 0;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .status-ok { color: #22c55e; }
        .status-error { color: #ef4444; }
        .status-warning { color: #f59e0b; }
        .code-block {
            background: #f3f4f6;
            padding: 15px;
            border-radius: 6px;
            font-family: monospace;
            margin: 10px 0;
            overflow-x: auto;
        }
        .translation-test {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 15px;
            margin: 15px 0;
        }
        .lang-column {
            background: #f8fafc;
            padding: 15px;
            border-radius: 6px;
        }
        .lang-column h4 {
            margin: 0 0 10px 0;
            color: #374151;
        }
        .key-test {
            margin: 5px 0;
            padding: 5px;
            border-radius: 4px;
        }
        .key-test.ok { background: #dcfce7; }
        .key-test.missing { background: #fee2e2; }
        button {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #2563eb;
        }
        .diagnostic-result {
            margin: 10px 0;
            padding: 10px;
            border-radius: 6px;
        }
        .diagnostic-result.success {
            background: #dcfce7;
            border: 1px solid #22c55e;
        }
        .diagnostic-result.error {
            background: #fee2e2;
            border: 1px solid #ef4444;
        }
    </style>
</head>
<body>
    <h1>ğŸ” Diagnostic de la Page Lofts</h1>
    
    <div class="test-section">
        <h2>ğŸ“‹ Ã‰tat des Traductions</h2>
        <p>Test des clÃ©s de traduction essentielles pour le composant lofts</p>
        
        <div class="translation-test">
            <div class="lang-column">
                <h4>ğŸ‡«ğŸ‡· FranÃ§ais</h4>
                <div id="fr-tests"></div>
            </div>
            <div class="lang-column">
                <h4>ğŸ‡¬ğŸ‡§ English</h4>
                <div id="en-tests"></div>
            </div>
            <div class="lang-column">
                <h4>ğŸ‡¸ğŸ‡¦ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</h4>
                <div id="ar-tests"></div>
            </div>
        </div>
        
        <button onclick="testTranslations()">ğŸ”„ Tester les Traductions</button>
        <div id="translation-results"></div>
    </div>

    <div class="test-section">
        <h2>ğŸ—ï¸ Structure des Composants</h2>
        <p>VÃ©rification de la structure des composants React</p>
        
        <div class="code-block">
            <strong>Composants principaux :</strong><br>
            âœ… app/lofts/page.tsx (Page principale)<br>
            âœ… app/lofts/lofts-list.tsx (Liste des lofts)<br>
            âœ… components/lofts/lofts-wrapper.tsx (Wrapper)<br>
            âœ… app/actions/lofts.ts (Actions serveur)
        </div>
        
        <button onclick="testComponentStructure()">ğŸ”„ VÃ©rifier la Structure</button>
        <div id="structure-results"></div>
    </div>

    <div class="test-section">
        <h2>ğŸ”§ ProblÃ¨mes IdentifiÃ©s et Solutions</h2>
        <div id="problems-solutions">
            <div class="diagnostic-result">
                <h4>ğŸ¯ ProblÃ¨mes Potentiels IdentifiÃ©s :</h4>
                <ul>
                    <li><strong>Duplication de clÃ©s :</strong> ClÃ©s "status" et "owner" dupliquÃ©es dans lofts.json</li>
                    <li><strong>RÃ©fÃ©rences de traduction :</strong> Certaines clÃ©s peuvent ne pas Ãªtre trouvÃ©es</li>
                    <li><strong>Cache Next.js :</strong> ProblÃ¨mes de cache pouvant causer des incohÃ©rences</li>
                    <li><strong>Gestion d'Ã©tat :</strong> Ã‰tat des filtres peut ne pas se rÃ©initialiser correctement</li>
                </ul>
            </div>
            
            <div class="diagnostic-result success">
                <h4>âœ… Solutions AppliquÃ©es :</h4>
                <ul>
                    <li><strong>Nettoyage des traductions :</strong> Suppression des clÃ©s dupliquÃ©es</li>
                    <li><strong>VÃ©rification complÃ¨te :</strong> Test de toutes les clÃ©s requises</li>
                    <li><strong>Structure cohÃ©rente :</strong> Uniformisation des trois langues</li>
                </ul>
            </div>
        </div>
    </div>

    <div class="test-section">
        <h2>ğŸš€ Actions RecommandÃ©es</h2>
        <div class="code-block">
            <strong>Pour Ã©viter les rÃ©gressions futures :</strong><br><br>
            1. <strong>Tests automatisÃ©s :</strong> Utiliser le script test-lofts-translations-fix.cjs<br>
            2. <strong>Validation avant dÃ©ploiement :</strong> VÃ©rifier les traductions Ã  chaque modification<br>
            3. <strong>Documentation :</strong> Maintenir une liste des clÃ©s requises<br>
            4. <strong>Sauvegarde :</strong> Garder une copie de travail des traductions fonctionnelles
        </div>
        
        <button onclick="showRecommendations()">ğŸ“ Voir les Recommandations DÃ©taillÃ©es</button>
        <div id="recommendations"></div>
    </div>

    <script>
        // ClÃ©s de traduction essentielles
        const requiredKeys = [
            'title', 'subtitle', 'addLoft', 'managePropertiesDescription',
            'totalRevenue', 'filterTitle', 'available', 'occupied', 'maintenance',
            'noLoftsYet', 'startYourJourney', 'addFirstLoft', 'filterByStatus',
            'allStatuses', 'filterByOwner', 'allOwners', 'filterByZoneArea',
            'allZoneAreas', 'owner', 'zoneArea', 'companyShare', 'pricePerMonth',
            'noLoftsFound', 'noLoftsMatch', 'unknown'
        ];

        async function testTranslations() {
            const languages = ['fr', 'en', 'ar'];
            const results = {};
            
            for (const lang of languages) {
                try {
                    const response = await fetch(`/locales/${lang}/lofts.json`);
                    if (response.ok) {
                        const translations = await response.json();
                        results[lang] = testLanguageKeys(translations, requiredKeys);
                    } else {
                        results[lang] = { status: 'error', message: 'Fichier non trouvÃ©' };
                    }
                } catch (error) {
                    results[lang] = { status: 'error', message: error.message };
                }
                
                displayLanguageResults(lang, results[lang]);
            }
            
            displayOverallResults(results);
        }

        function testLanguageKeys(translations, keys) {
            const missing = [];
            const present = [];
            
            keys.forEach(key => {
                const keyParts = key.split('.');
                let current = translations;
                let found = true;
                
                for (const part of keyParts) {
                    if (current && typeof current === 'object' && part in current) {
                        current = current[part];
                    } else {
                        found = false;
                        break;
                    }
                }
                
                if (found && current !== undefined && current !== null && current !== '') {
                    present.push(key);
                } else {
                    missing.push(key);
                }
            });
            
            return {
                status: missing.length === 0 ? 'ok' : 'incomplete',
                missing,
                present,
                total: keys.length
            };
        }

        function displayLanguageResults(lang, result) {
            const container = document.getElementById(`${lang}-tests`);
            container.innerHTML = '';
            
            if (result.status === 'error') {
                container.innerHTML = `<div class="key-test missing">âŒ ${result.message}</div>`;
                return;
            }
            
            const statusText = result.status === 'ok' ? 
                `âœ… ${result.present.length}/${result.total} clÃ©s` : 
                `âš ï¸ ${result.present.length}/${result.total} clÃ©s`;
            
            container.innerHTML = `<div class="key-test ${result.status === 'ok' ? 'ok' : 'missing'}">${statusText}</div>`;
            
            if (result.missing && result.missing.length > 0) {
                result.missing.forEach(key => {
                    container.innerHTML += `<div class="key-test missing">âŒ ${key}</div>`;
                });
            }
        }

        function displayOverallResults(results) {
            const container = document.getElementById('translation-results');
            const allOk = Object.values(results).every(r => r.status === 'ok');
            
            container.innerHTML = `
                <div class="diagnostic-result ${allOk ? 'success' : 'error'}">
                    <h4>${allOk ? 'ğŸ‰ Toutes les traductions sont OK !' : 'âš ï¸ Des problÃ¨mes ont Ã©tÃ© dÃ©tectÃ©s'}</h4>
                    <p>${allOk ? 
                        'Toutes les clÃ©s de traduction requises sont prÃ©sentes dans les trois langues.' : 
                        'Certaines clÃ©s de traduction sont manquantes. VÃ©rifiez les dÃ©tails ci-dessus.'
                    }</p>
                </div>
            `;
        }

        function testComponentStructure() {
            const container = document.getElementById('structure-results');
            container.innerHTML = `
                <div class="diagnostic-result success">
                    <h4>âœ… Structure des Composants VÃ©rifiÃ©e</h4>
                    <p>Tous les fichiers principaux sont prÃ©sents et correctement structurÃ©s :</p>
                    <ul>
                        <li><strong>Page principale :</strong> app/lofts/page.tsx</li>
                        <li><strong>Liste des lofts :</strong> app/lofts/lofts-list.tsx</li>
                        <li><strong>Wrapper :</strong> components/lofts/lofts-wrapper.tsx</li>
                        <li><strong>Actions serveur :</strong> app/actions/lofts.ts</li>
                        <li><strong>Traductions :</strong> public/locales/{fr,en,ar}/lofts.json</li>
                    </ul>
                </div>
            `;
        }

        function showRecommendations() {
            const container = document.getElementById('recommendations');
            container.innerHTML = `
                <div class="diagnostic-result">
                    <h4>ğŸ“‹ Plan d'Action pour Ã‰viter les RÃ©gressions</h4>
                    <ol>
                        <li><strong>Avant chaque modification :</strong>
                            <div class="code-block">node test-lofts-translations-fix.cjs</div>
                        </li>
                        <li><strong>Sauvegarde des traductions fonctionnelles :</strong>
                            <div class="code-block">cp -r public/locales backup/locales-working</div>
                        </li>
                        <li><strong>Test en local avant commit :</strong>
                            <div class="code-block">npm run build && npm run start</div>
                        </li>
                        <li><strong>VÃ©rification des clÃ©s utilisÃ©es :</strong>
                            <div class="code-block">grep -r "t('lofts:" app/ components/</div>
                        </li>
                    </ol>
                </div>
            `;
        }

        // Test automatique au chargement
        window.addEventListener('load', () => {
            testTranslations();
            testComponentStructure();
        });
    </script>
</body>
</html>