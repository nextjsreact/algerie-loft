<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Login Simple</title>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <style>
        body { font-family: Arial, sans-serif; max-width: 500px; margin: 50px auto; padding: 20px; }
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; }
        input { width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; }
        button { background: #007bff; color: white; padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; }
        button:disabled { background: #ccc; }
        .error { color: red; margin-top: 10px; }
        .success { color: green; margin-top: 10px; }
        .info { background: #f0f0f0; padding: 10px; border-radius: 4px; margin-bottom: 20px; }
    </style>
</head>
<body>
    <h1>üîê Test Login Simple - DEV</h1>
    
    <div class="info">
        <strong>Identifiants de test:</strong><br>
        Email: admin@dev.local<br>
        Mot de passe: dev123
    </div>

    <form id="loginForm">
        <div class="form-group">
            <label for="email">Email:</label>
            <input type="email" id="email" value="admin@dev.local" required>
        </div>
        
        <div class="form-group">
            <label for="password">Mot de passe:</label>
            <input type="password" id="password" value="dev123" required>
        </div>
        
        <button type="submit" id="loginBtn">Se connecter</button>
    </form>

    <div id="status"></div>
    <div id="sessionInfo"></div>

    <script>
        // Configuration Supabase DEV
        const supabaseUrl = 'https://wtcbyjdwjrrqyzpvjfze.supabase.co'
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Ind0Y2J5amR3anJycXl6cHZqZnplIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDU4NDY0NTYsImV4cCI6MjA2MTQyMjQ1Nn0.qQrgqOSLldFuHK1XjCZyRcCgJsmSBdibmo40DsxyF3o'
        
        const supabase = window.supabase.createClient(supabaseUrl, supabaseKey)
        
        const form = document.getElementById('loginForm')
        const loginBtn = document.getElementById('loginBtn')
        const status = document.getElementById('status')
        const sessionInfo = document.getElementById('sessionInfo')

        // V√©rifier la session au chargement
        checkSession()

        form.addEventListener('submit', async (e) => {
            e.preventDefault()
            
            const email = document.getElementById('email').value
            const password = document.getElementById('password').value
            
            loginBtn.disabled = true
            loginBtn.textContent = 'Connexion en cours...'
            status.innerHTML = ''
            
            try {
                console.log('üîê Tentative de connexion:', email)
                
                const { data, error } = await supabase.auth.signInWithPassword({
                    email: email,
                    password: password
                })
                
                if (error) {
                    throw error
                }
                
                status.innerHTML = '<div class="success">‚úÖ Connexion r√©ussie!</div>'
                console.log('‚úÖ Connexion r√©ussie:', data)
                
                // Afficher les infos de session
                displaySessionInfo(data)
                
            } catch (error) {
                console.error('‚ùå Erreur:', error)
                status.innerHTML = `<div class="error">‚ùå Erreur: ${error.message}</div>`
            } finally {
                loginBtn.disabled = false
                loginBtn.textContent = 'Se connecter'
            }
        })

        async function checkSession() {
            try {
                const { data: { session }, error } = await supabase.auth.getSession()
                
                if (error) {
                    console.error('Erreur session:', error)
                    return
                }
                
                if (session) {
                    status.innerHTML = '<div class="success">‚úÖ Session active d√©tect√©e</div>'
                    displaySessionInfo({ session, user: session.user })
                } else {
                    status.innerHTML = '<div class="info">‚ÑπÔ∏è Aucune session active</div>'
                }
            } catch (error) {
                console.error('Erreur v√©rification session:', error)
            }
        }

        function displaySessionInfo(data) {
            if (data.session && data.user) {
                sessionInfo.innerHTML = `
                    <div class="info">
                        <h3>üìã Informations de session:</h3>
                        <p><strong>Email:</strong> ${data.user.email}</p>
                        <p><strong>ID:</strong> ${data.user.id}</p>
                        <p><strong>Cr√©√©:</strong> ${new Date(data.user.created_at).toLocaleString()}</p>
                        <p><strong>Session expire:</strong> ${new Date(data.session.expires_at * 1000).toLocaleString()}</p>
                        <button onclick="logout()">Se d√©connecter</button>
                    </div>
                `
            }
        }

        async function logout() {
            try {
                const { error } = await supabase.auth.signOut()
                if (error) throw error
                
                status.innerHTML = '<div class="success">‚úÖ D√©connexion r√©ussie</div>'
                sessionInfo.innerHTML = ''
                console.log('‚úÖ D√©connexion r√©ussie')
            } catch (error) {
                console.error('‚ùå Erreur d√©connexion:', error)
                status.innerHTML = `<div class="error">‚ùå Erreur d√©connexion: ${error.message}</div>`
            }
        }

        // √âcouter les changements d'√©tat d'authentification
        supabase.auth.onAuthStateChange((event, session) => {
            console.log('üîÑ Auth state change:', event, session?.user?.email)
            
            if (event === 'SIGNED_IN') {
                status.innerHTML = '<div class="success">‚úÖ Connexion confirm√©e par listener</div>'
            } else if (event === 'SIGNED_OUT') {
                status.innerHTML = '<div class="info">‚ÑπÔ∏è D√©connexion confirm√©e</div>'
                sessionInfo.innerHTML = ''
            }
        })
    </script>
</body>
</html>