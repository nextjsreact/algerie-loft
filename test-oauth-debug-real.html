<!DOCTYPE html>
<html>
<head>
    <title>Test OAuth Debug - Real</title>
</head>
<body>
    <h1>Test OAuth Debug - Configuration R√©elle</h1>
    
    <div id="results"></div>
    
    <script type="module">
        import { createClient } from 'https://cdn.skypack.dev/@supabase/supabase-js@2'
        
        const supabaseUrl = 'https://mhngbluefyucoesgcjoy.supabase.co'
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1obmdibHVlZnl1Y29lc2djam95Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDYxMzE3MjIsImV4cCI6MjA2MTcwNzcyMn0.buEObYOAzS8eCKZ6tti0gER1Xh1pjmEAMbDJVnX5WDU'
        
        const supabase = createClient(supabaseUrl, supabaseKey)
        
        const results = document.getElementById('results')
        
        // Test 1: V√©rifier la configuration OAuth actuelle
        results.innerHTML += '<h2>Test 1: Configuration OAuth</h2>'
        
        const currentUrl = window.location.origin
        const testRedirectUrl = `${currentUrl}/api/auth/callback?next=/fr&role=client`
        
        results.innerHTML += `<p><strong>URL de redirection test√©e:</strong> ${testRedirectUrl}</p>`
        
        // Test 2: Simuler OAuth Google
        const googleButton = document.createElement('button')
        googleButton.textContent = 'Test OAuth Google'
        googleButton.onclick = async () => {
            try {
                results.innerHTML += '<p>üîÑ Tentative OAuth Google...</p>'
                
                const { data, error } = await supabase.auth.signInWithOAuth({
                    provider: 'google',
                    options: {
                        redirectTo: testRedirectUrl
                    }
                })
                
                if (error) {
                    results.innerHTML += `<p style="color: red;">‚ùå Erreur OAuth: ${error.message}</p>`
                } else {
                    results.innerHTML += '<p style="color: green;">‚úÖ OAuth initi√© avec succ√®s</p>'
                    results.innerHTML += `<p>URL de redirection configur√©e: ${testRedirectUrl}</p>`
                }
            } catch (err) {
                results.innerHTML += `<p style="color: red;">‚ùå Exception: ${err.message}</p>`
            }
        }
        
        // Test 3: Simuler OAuth GitHub
        const githubButton = document.createElement('button')
        githubButton.textContent = 'Test OAuth GitHub'
        githubButton.onclick = async () => {
            try {
                results.innerHTML += '<p>üîÑ Tentative OAuth GitHub...</p>'
                
                const { data, error } = await supabase.auth.signInWithOAuth({
                    provider: 'github',
                    options: {
                        redirectTo: testRedirectUrl
                    }
                })
                
                if (error) {
                    results.innerHTML += `<p style="color: red;">‚ùå Erreur OAuth: ${error.message}</p>`
                } else {
                    results.innerHTML += '<p style="color: green;">‚úÖ OAuth initi√© avec succ√®s</p>'
                    results.innerHTML += `<p>URL de redirection configur√©e: ${testRedirectUrl}</p>`
                }
            } catch (err) {
                results.innerHTML += `<p style="color: red;">‚ùå Exception: ${err.message}</p>`
            }
        }
        
        results.appendChild(googleButton)
        results.appendChild(githubButton)
        
        // Afficher les URLs de redirection configur√©es dans Supabase
        results.innerHTML += '<h2>URLs de redirection Supabase</h2>'
        results.innerHTML += '<p>Selon votre capture d\'√©cran:</p>'
        results.innerHTML += '<ul>'
        results.innerHTML += '<li>https://loftalgerie.com/api/auth/callback</li>'
        results.innerHTML += '<li>https://loftalgerie.com/auth/reset-password</li>'
        results.innerHTML += '</ul>'
        results.innerHTML += '<p><strong>Probl√®me potentiel:</strong> Manque localhost pour le d√©veloppement</p>'
        
    </script>
</body>
</html>